<!DOCTYPE html>
<html>
<head>
{include file="public:title"/}
<style media="screen">
.layui-form-select{
  width: 100px;
}
.layui-form-item .layui-input-inline{
  width: auto;
}
</style>
</head>
<body onload="last()">
  <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-col-md12">
        <div class="layui-card">
          <div class="layui-card-header">编辑客户</div>
          <div class="layui-form layui-card-body" pad15>
              <div class="layui-form-item layui-form-text">
                <h3 style="text-align:center;width: 80px;height: 40px;line-height: 40px;border-bottom: 2px solid #1E9FFF;margin: 0 auto;">客户信息</h3>
              </div>
               <div class="layui-form-item">
                <input type="hidden" name="id" value="{$client['id']}">
                    <label class="layui-form-label" for="name">客户名称</label>
                    <div class="layui-input-inline">
                      <input type="text" name="name" id="name" lay-verify="name|required" class="layui-input" placeholder="请在此输入客户姓名" value="{$client['name']}">
                    </div>

                    <label class="layui-form-label" for="sex">客户性别</label>
                    <div class="layui-input-inline">
                      <select class="layui-input" name="sex">
                          <option value="1" {if condition="$client['sex'] eq 1"} selected {/if}>男</option>
                          <option value="2" {if condition="$client['sex'] eq 2"} selected {/if}>女</option>
                      </select>
                    </div>

                    <label class="layui-form-label" for="phone">客户电话</label>
                    <div class="layui-input-inline">
                      <input type="text" name="phone" id="phone" class="layui-input" placeholder="请在此输入客户电话" value="{$client['phone']}">
                    </div>
				        </div>
                <div class="layui-form-item">
                  <label class="layui-form-label" for="city-picker">所属城市</label>
                  <div class="layui-input-block">
                    <input type="text" autocomplete="on" class="layui-input" id="city-picker" name="city" value="{$client['city']}" readonly="readonly" data-toggle="city-picker" placeholder="请选择">
                  </div>
                </div>
				        <div class="layui-form-item">
                    <label class="layui-form-label" for="wechat">客户微信</label>
                    <div class="layui-input-inline">
                      <input type="text" name="wechat" id="wechat" class="layui-input" placeholder="请在此输入客户微信"  value="{$client['wechat']}">
                    </div>

                    <label class="layui-form-label" for="qq">客户QQ</label>
                    <div class="layui-input-inline">
                      <input type="text" name="qq" id="qq" class="layui-input" placeholder="请在此输入客户QQ" value="{if condition='$client.qq neq 0'}{$client['qq']}{/if}">
                    </div>

                    <label class="layui-form-label" for="type">客户类型</label>
                    <div class="layui-input-inline">
                      <select class="layui-input" name="type" >
                          <option value="1" {if condition="$client['type'] eq 1"} selected {/if}>私企</option>
                          <option value="2" {if condition="$client['type'] eq 2"} selected {/if}>国企</option>
                          <option value="3" {if condition="$client['type'] eq 3"} selected {/if}>上市</option>
                          <option value="4" {if condition="$client['type'] eq 4"} selected {/if}>个人</option>
                          <option value="5" {if condition="$client['type'] eq 5"} selected {/if}>政府</option>
                      </select>
                    </div>

                    <label class="layui-form-label" for="email">客户邮箱</label>
                    <div class="layui-input-inline">
                      <input type="text" name="email" id="email" class="layui-input" placeholder="请在此输入客户邮箱" value="{$client['email']}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="quarters">岗位职称</label>
                    <div class="layui-input-inline">
                      <input type="text" name="quarters" id="quarters" class="layui-input" placeholder="请在此输入岗位职称" value="{$client['quarters']}">
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                  <h3 style="text-align:center;width: 80px;height: 40px;line-height: 40px;border-bottom: 2px solid #1E9FFF;margin: 0 auto;">兴趣爱好</h3>
                </div>

                <div class="layui-form-item">
                  <label class="layui-form-label" for="interests">选择兴趣</label>
                  <div class="layui-input-block">
                    <input type="checkbox" name="interests" value="旅游" title="旅游" {if condition="in_array('旅游',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="阅读" title="阅读" {if condition="in_array('阅读',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="电影" title="电影" {if condition="in_array('电影',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="聚会" title="聚会" {if condition="in_array('聚会',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="唱歌" title="唱歌" {if condition="in_array('唱歌',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="交友" title="交友" {if condition="in_array('交友',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="摄影" title="摄影" {if condition="in_array('摄影',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="球类" title="球类" {if condition="in_array('球类',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="逛街" title="逛街" {if condition="in_array('逛街',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="爬山" title="爬山" {if condition="in_array('爬山',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="宅家" title="宅家" {if condition="in_array('宅家',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="下棋" title="下棋" {if condition="in_array('下棋',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="书画" title="书画" {if condition="in_array('书画',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="荣誉" title="荣誉" {if condition="in_array('荣誉',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="面子" title="面子" {if condition="in_array('面子',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="喝酒" title="喝酒" {if condition="in_array('喝酒',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="喝茶" title="喝茶" {if condition="in_array('喝茶',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="吃货" title="吃货" {if condition="in_array('吃货',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="运动" title="运动" {if condition="in_array('运动',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="美容" title="美容" {if condition="in_array('美容',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="钱财" title="钱财" {if condition="in_array('钱财',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="美女" title="美女" {if condition="in_array('美女',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="收藏" title="收藏" {if condition="in_array('收藏',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="集邮" title="集邮" {if condition="in_array('集邮',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="游戏" title="游戏" {if condition="in_array('游戏',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="瑜伽" title="瑜伽" {if condition="in_array('瑜伽',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="舞蹈" title="舞蹈" {if condition="in_array('舞蹈',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="跑步" title="跑步" {if condition="in_array('跑步',$interests) eq true"} checked {/if}>
                    <input type="checkbox" name="interests" value="武术" title="武术" {if condition="in_array('武术',$interests) eq true"} checked {/if}>
                  </div>
                </div>

                <div class="layui-form-item layui-form-text">
                  <h3 style="text-align:center;width: 80px;height: 40px;line-height: 40px;border-bottom: 2px solid #1E9FFF;margin: 0 auto;">公司信息</h3>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label" for="sitename">公司名称</label>
                    <div class="layui-input-inline">
                      <input type="text" name="sitename" id="sitename" class="layui-input" placeholder="请在此输入公司名称" value="{$client['sitename']}">
                    </div>

                    <label class="layui-form-label" for="website">公司官网</label>
                    <div class="layui-input-inline">
                      <input type="text" name="website" id="website" class="layui-input" placeholder="请在此输入公司官网" value="{$client['website']}">
                    </div>

                    <label class="layui-form-label" for="siteaddress">公司地址</label>
                    <div class="layui-input-inline">
                      <input type="text" name="siteaddress" id="siteaddress" class="layui-input" placeholder="请在此输入公司地址" value="{$client['siteaddress']}">
                    </div>

                    <label class="layui-form-label" for="industry">所属行业</label>
                    <div class="layui-input-inline">
                      <input type="hidden" id="industry_id" value="{$client['industry']}">
                       <select class="layui-input" name="industry" id="industry">
                      </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="brand">主营业务</label>
                    <div class="layui-input-inline">
                      <input type="text" name="brand" id="brand" class="layui-input" placeholder="请在此输入主营业务" value="{$client['brand']}">
                    </div>

                    <label class="layui-form-label" for="busi">产品品牌</label>
                    <div class="layui-input-inline">
                      <input type="text" name="busi" id="busi" class="layui-input" placeholder="请输入产品品牌" value="{$client['busi']}">
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                  <h3 style="text-align:center;width: 80px;height: 40px;line-height: 40px;border-bottom: 2px solid #1E9FFF;margin: 0 auto;">需求信息</h3>
                </div>





              <div class="layui-form-item">
                    <label class="layui-form-label" for="project_id">所属项目</label>
                    <div class="layui-input-inline">
                      <select class="layui-input" name="project_id" id="project_id" lay-search lay-filter="project_id">
                        {volist name="project" id="vv"}
                          <option value="{$vv['id']}" {if condition="$client['project_id'] eq $vv['id']"} selected {/if}>{$vv['name']}</option>
                        {/volist}
                      </select>
                    </div>

                    <input type="hidden" id="business2" value="{$client['business']}">

                    <label class="layui-form-label" for="staff_idcard">业务类型</label>
                    <div class="layui-input-inline">
                      <select class="layui-input" name="business" id="business"  lay-search lay-filter="business">
                      </select>
                    </div>

                    <label class="layui-form-label" for="staff_province">前期状态</label>
                    <div class="layui-input-inline">
                      <select class="layui-input" name="stage">
                          <option value="1" {if condition="$client['stage'] eq 1"} selected {/if}>有</option>
                          <option value="0" {if condition="$client['stage'] eq 0"} selected {/if}>无</option>
                      </select>
                    </div>
                </div>
                <div class="layui-form-item">
                  <input type="hidden" id="service2" value="{$client['service']}">
                  <label class="layui-form-label" for="service">选择服务</label>
                  <div class="layui-input-block" id="service">
                  </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label" for="budget">预算金额</label>
                    <div class="layui-input-inline">
                      <input type="text" name="budget" id="budget" class="layui-input" placeholder="请在此输入预算金额" value="{$client['budget']}">
                    </div>

                    <label class="layui-form-label" for="makemoney">成交金额</label>
                    <div class="layui-input-inline">
                      <input type="text" name="makemoney" id="makemoney" class="layui-input" placeholder="请在此输入成交金额"  value="{$client['makemoney']}">
                    </div>

                    <label class="layui-form-label" for="moneystate">预算说明</label>
                    <div class="layui-input-inline">
                     <select class="layui-input" name="moneystate">
                          <option value="1" {if condition="$client['moneystate'] eq 1"} selected {/if}>全款</option>
                          <option value="2" {if condition="$client['moneystate'] eq 2"} selected {/if}>年付</option>
                          <option value="3" {if condition="$client['moneystate'] eq 3"} selected {/if}>季付</option>
                          <option value="4" {if condition="$client['moneystate'] eq 4"} selected {/if}>月付</option>
                          <option value="5" {if condition="$client['moneystate'] eq 5"} selected {/if}>5:5</option>
                          <option value="6" {if condition="$client['moneystate'] eq 6"} selected {/if}>5:2:3</option>
                      </select>
                    </div>
                </div>
                <div class="layui-form-item">
                <label class="layui-form-label" for="remark">备注说明</label>
                <div class="layui-input-block">
                  <textarea name="remark" id="remark" class="layui-textarea" lay-verify="remark|required">{$client['remark']}</textarea>
                </div>
              </div>


              <div class="layui-form-item layui-form-text">
                  <h3 style="text-align:center;width: 80px;height: 40px;line-height: 40px;border-bottom: 2px solid #1E9FFF;margin: 0 auto;">客户来源</h3>
                </div>

               <div class="layui-form-item">
                <label class="layui-form-label" for="ditch_id">渠道</label>
                <div class="layui-input-inline">
                  <select class="layui-input" name="ditch_id" id="ditch_id" lay-filter="ditch_id">
                    {volist name="typelist" id="vv"}
                    <option value="{$vv['id']}" {if condition="$client['ditch_id'] eq $vv['id']"} selected {/if}>{$vv['typename']}</option>
                    {/volist}
                  </select>
                </div>

                <label class="layui-form-label" for="source_id">来源入口</label>
                <input type="hidden" id="source_ids" value="{$client['source_id']}">
                <div class="layui-input-inline">
                  <select class="layui-input" id="source_id" name="source_id" lay-filter="source_id">
                  </select>
                </div>
              </div>
              <div class="layui-form-item">
                <input type="hidden" id="tools_id" value="{$client['tools_ids']}">
                <label class="layui-form-label" for="tools_ids">咨询工具</label>
                <div class="layui-input-block" id="tools_ids">
                </div>
              </div>

            <div class="layui-form-item layui-form-text">
                  <h3 style="text-align:center;width: 80px;height: 40px;line-height: 40px;border-bottom: 2px solid #1E9FFF;margin: 0 auto;">客户状态</h3>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label" for="schedule">选择状态</label>
                <div class="layui-input-inline">
                  <select class="layui-input" name="schedule" id="schedule">
                    {foreach $kv as $k}
                    <option value="{$k.id}" {if condition="$client['schedule'] == $k.id"}selected{/if}>{$k.name}</option>
                    {/foreach}
                  </select>
                </div>
              </div>
              <input type="hidden" id="xing" value="{$client['level']}">
              <div class="layui-form-item">
                  <label class="layui-form-label" for="staff_hobby">客户星级</label>
                  <div class="layui-input-block">
                    <div><div id="test4"></div></div>
                  </div>
                </div>
              <div class="layui-form-item">
                <div class="layui-input-block">
                    <label class="layui-form-label"><button class="layui-btn" lay-submit lay-filter="add">点击提交</button></label>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="__TROOT__/layuiadmin/layui_exts/city-picker/city-picker.data.js"></script>
  <link href="__TROOT__/layuiadmin/layui_exts/city-picker/city-picker.css" rel="stylesheet" />
  <script>
    //行业ajax请求
    var industry_id = $('#industry_id').val();
    $.post("{:url('AjaxAction/industryAction')}",{id:industry_id},function(data){
      $('#industry').html(data);
      layui.use(['form'], function(){
        var form = layui.form;
        form.render('select');
      });
    });
    //来源三级联动
    var ditch_id = $('#ditch_id').val();
    var source_ids = $('#source_ids').val();
    $.post("{:url('AjaxAction/source')}",{id:ditch_id,source_id:source_ids},function(data){
      $('#source_id').html(data);
      layui.use(['form'], function(){
        var form = layui.form;
        form.render('select');
        var tools_id = $('#tools_id').val();
        $.post("{:url('AjaxAction/Tools')}",{id:source_ids,tools_ids:tools_id},function(data){
          $('#tools_ids').html(data);
          layui.use(['form'], function(){
            var form = layui.form;
            form.render('checkbox');
          });
        });
      });
    });
    layui.config({
      base: '__TROOT__/layuiadmin/layui_exts/' //静态资源所在路径
    }).extend({
      citypicker: 'city-picker/city-picker' // {/}的意思即代表采用自有路径，即不跟随 base 路径
    }).use(['citypicker'], function() {
      var $ = layui.$,
        cityPicker = layui.citypicker;
      var currentPicker = new cityPicker("#city-picker", {
        provincename: "provinceId",
        cityname: "cityId",
        districtname: "districtId",
        level: 'districtId', // 级别
      });
    });
    layui.use(['form','upload','rate'], function(){
      var form = layui.form,upload = layui.upload;var rate = layui.rate;
      //半星效果
      var xing = $("#xing").val();
      var xingval = "";
      if(xing=="0.5"){
        var xingval = 0.5;
      }
      if(xing=="1"){
        var xingval = 1;
      }
      if(xing=="1.5"){
        var xingval = 1.5;
      }
      if(xing=="2"){
        var xingval = 2;
      }
      if(xing=="2.5"){
        var xingval = 2.5;
      }
      if(xing=="3"){
        var xingval = 3;
      }
      if(xing=="3.5"){
        var xingval = 3.5;
      }
      if(xing=="4"){
        var xingval = 4;
      }
      if(xing=="4.5"){
        var xingval = 4.5;
      }
      if(xing=="5"){
        var xingval = 5;
      }
      if(xingval==false){
        var xingval = 5;
      };
      rate.render({
        elem: '#test4'
        ,value: xingval
        ,half: true
        ,text: true
      });
      form.on('select(project_id)', function(data) {
        var areaId = data.value;
        $.ajax({
          url:"{:url('AjaxAction/business')}",
          data:{id:areaId},
          type:'post',
          success:function(data){
            $("#business").html(data);
            form.render('select');
          }
        });
      });

      //渠道下拉联动
      form.on('select(ditch_id)', function(data) {
        var areaId = data.value;
        $.ajax({
          url:"{:url('AjaxAction/source')}",
          data:{id:areaId},
          type:'post',
          success:function(data){
            $("#source_id").html(data);
            form.render('select');
          }
        });
      });
      //渠道下拉联动
      form.on('select(source_id)', function(data) {
        var areaId = data.value;
        $.ajax({
          url:"{:url('AjaxAction/Tools')}",
          data:{id:areaId},
          type:'post',
          success:function(data){
            $("#tools_ids").html(data);
            form.render('checkbox');
          }
        });
      });
      form.on('select(business)', function(data) {
        var areaId = data.value;
        $.ajax({
          url:"{:url('AjaxAction/service')}",
          data:{id:areaId},
          type:'post',
          success:function(data){
            $("#service").html(data);
            form.render('checkbox');
          }
        });
      });

      form.on('submit(add)', function(data){
        var level = $("#test4").children("span").html();
        data.field.level      = level.substr(0,level.length-1);
        data.field.interests  = returnCheckboxItem("interests");
        data.field.tools_ids = returnCheckboxItem("tools_ids");
        data.field.service    = returnCheckboxItem("service");
        $.ajax({
            type:'POST',
            url:'{:url("sales/updateorder")}',
            data: {
              data:JSON.stringify(data.field)
            },
            success:function (data) {
              var status = JSON.parse(data);
              if (status.icon == 6){
                layer.msg(status.msg,{icon: status.icon,time:1000},function(){
                  window.parent.location.reload();
                });
              } else {
                layer.msg(status.msg,{icon: status.icon,time:1000},function(){
                  window.location.reload();
                });
              }
            }
        });
        return false;
      });
    });
    //页面加载默认一个三级联动
    function last(){
      //一级联动
      var yewuid = $("#project_id option:first").val();
      layui.use(['form','element'], function(){
        var form = layui.form,
        element = layui.element;
        $.ajax({
          url:"{:url('AjaxAction/business')}",
          data:{id:yewuid},
          type:'post',
          success:function(data){
            $("#business").html(data);
            //二级联动
            var business = $("#business option:first").val();
            var service_id = $('#service2').val();
            $.ajax({
              url:"{:url('AjaxAction/service')}",
              data:{id:business,service:service_id},
              type:'post',
              success:function(data){
                if(data == '暂无服务'){
                  $("#services").css({'display':'none'});
                }else{
                  $("#services").css({'display':'block'});
                  $("#service").html(data);
                }
                form.render('checkbox');
              }
            });
            form.render('select');
          }
        });
      });
    }
    function returnCheckboxItem(name){
      var adIds = "";
      $('input:checkbox[name="'+name+'"]:checked').each(function(i){
        if(0==i){
            adIds = $(this).val();
        }else{
            adIds += (","+$(this).val());
        }
      });
      return adIds
    }
  </script>
</body>
</html>
